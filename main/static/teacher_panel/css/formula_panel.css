/* Global formula panel styles extracted */
#global-formula-toggle {position:fixed;bottom:18px;right:18px;z-index:1200;background:#1976d2;color:#fff;border:none;border-radius:50%;width:54px;height:54px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 6px 18px rgba(25,118,210,.35);font-size:26px;font-weight:600;}
#global-formula-toggle:hover{background:#125ea8;}
.gfp-close{background:#fff;color:#1976d2;border:none;font-weight:700;font-size:18px;width:34px;height:34px;border-radius:10px;cursor:pointer;}
.global-formula-panel{position:fixed;bottom:88px;right:18px;width:520px;max-height:55vh;background:#ffffff;border:2px solid #1976d2;border-radius:18px;box-shadow:0 14px 38px -6px rgba(25,118,210,.35),0 4px 14px rgba(0,0,0,.08);display:none;flex-direction:column;overflow:hidden;z-index:1300;font-family:inherit;}
.global-formula-panel.open{display:flex;animation:fadeIn .18s ease;}
.gfp-header{display:flex;align-items:center;gap:8px;padding:10px 14px;background:linear-gradient(90deg,#1976d2,#42a5f5);color:#fff;}
.gfp-header input{flex:1 1 auto;padding:6px 10px;border:none;border-radius:8px;font-size:.9rem;outline:none;}
.gfp-body{padding:10px 12px 16px 12px;overflow:auto;display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));grid-gap:8px;}
.gfp-btn{background:#f1f7fe;border:1px solid #c4d9ef;border-radius:10px;padding:6px 6px 4px 6px;cursor:pointer;font-size:15px;line-height:1.1;display:flex;align-items:center;justify-content:center;min-height:46px;transition:background .16s,border-color .16s,transform .16s;}
.gfp-btn:hover{background:#1976d2;color:#fff;border-color:#1976d2;transform:translateY(-2px);} 
.gfp-footer{padding:6px 12px;border-top:1px solid #e2ecf6;font-size:.72rem;display:flex;justify-content:space-between;align-items:center;background:#fafcff;color:#345;}
.gfp-category-bar{display:flex;gap:6px;padding:6px 10px 4px 10px;overflow-x:auto;background:#fafcff;border-bottom:1px solid #e2ecf6;}
.gfp-cat{background:#e3f0fc;border:1px solid #c2d9ee;padding:4px 10px;border-radius:20px;font-size:.72rem;font-weight:600;cursor:pointer;white-space:nowrap;color:#145792;}
.gfp-cat.active{background:#1976d2;color:#fff;border-color:#1976d2;}
.gfp-cat.gfp-cat-dyn{background:#ffe9c7;border-color:#f5c888;color:#8a5200;}
.gfp-cat.gfp-cat-dyn.active{background:#ffb74d;border-color:#ffb74d;color:#fff;}
.gfp-doc{ text-decoration:none;color:#1976d2;font-weight:600;}
@media(max-width:680px){.global-formula-panel{right:10px;left:10px;width:auto;}}

/* Mini inline badge */
.mini-formula-badge{position:absolute;z-index:1400;background:#1976d2;color:#fff;border:none;border-radius:8px;padding:4px 6px;font-size:15px;line-height:1;cursor:pointer;display:none;box-shadow:0 4px 12px rgba(0,0,0,.18);align-items:center;justify-content:center;}
.mini-formula-badge:hover{background:#125ea8;}
.gfp-add-snippet{background:#2563eb;color:#fff;border:none;font-size:14px;cursor:pointer;padding:2px 8px;border-radius:4px;margin-right:6px;}
.gfp-add-snippet:hover{background:#1e4fb8;}
.gfp-modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:100000;}
.gfp-modal-content{background:#fff;width:420px;max-width:92%;border-radius:10px;box-shadow:0 8px 30px -4px rgba(0,0,0,.3);padding:14px 16px;font-family:var(--gfp-font);}
.gfp-modal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;}
.gfp-modal-head button{background:none;border:none;font-size:20px;cursor:pointer;line-height:1;color:#64748b;}
.gfp-modal-head button:hover{color:#0f172a;}
.gfp-modal-body input,.gfp-modal-body textarea{width:100%;border:1px solid #cbd5e1;border-radius:6px;padding:6px 8px;font-size:14px;font-family:monospace;background:#f8fafc;}
.gfp-modal-body textarea{resize:vertical;}
.gfp-snippet-actions{display:flex;gap:8px;margin-top:8px;}
.gfp-save-btn{background:#16a34a;color:#fff;border:none;border-radius:6px;padding:6px 12px;font-size:13px;cursor:pointer;}
.gfp-save-btn:hover{background:#15803d;}
.gfp-cancel-btn{background:#f1f5f9;color:#475569;border:1px solid #cbd5e1;border-radius:6px;padding:6px 12px;font-size:13px;cursor:pointer;}
.gfp-cancel-btn:hover{background:#e2e8f0;}
.gfp-snippet-error{margin-top:6px;color:#dc2626;font-size:12px;font-weight:600;}
.gfp-alias-pill{display:inline-block;background:#e0f2fe;color:#075985;font-size:10px;font-weight:600;padding:2px 5px;border-radius:4px;margin-left:4px;vertical-align:middle;}
.gfp-bad-latex{outline:2px solid #dc2626;animation:gfpPulse .8s linear 1;}
@keyframes gfpPulse{0%{outline-color:#dc2626;}50%{outline-color:#fbbf24;}100%{outline-color:#dc2626;}}
